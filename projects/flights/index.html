<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="styles.css">
	<link href='http://fonts.googleapis.com/css?family=Lato:100,300,400|Ubuntu:300,400|Open+Sans:400,300|Oxygen:400,300' rel='stylesheet' type='text/css'>
	<title>Air traffic visualization</title>
</head>

<body>
	
	<div id="menu">
		<h1>Air traffic visualization</h1>
		<div id="links">
			<ul>
				<li id="about">About</li>
				<li id="invert-btn">Switch colors</li>
			</ul>
		</div>
		<div style="    position: absolute;    top: 100px;    left: 34px;">
			City with few airports <svg width="10px" height="10px" style="width: 10px; height: 10px"><circle  cx="5" cy="5" r="3"></circle></svg><br/>
			City with many airports <svg width="10px" height="10px" style="width: 16px; height: 16px"><circle  cx="8" cy="8" r="8"></circle></svg>
			
		</div>
	</div>
	
	<div id="graph"></div>
	<div id="info">
		<div>
		<h3>What?</h3>This graph visualizes the <a href="http://openflights.org/data.html" target="_blank">OpenFlights</a> data set which holds the information about airports and flights. In addition, the <a href="http://www.geonames.org/" target="_blank">GeoNames</a> data set was used to obtain population of the cities. Cities are represented by the circles which are organized into three main axes: Asian, European and North American. The closer the city is the the center of the graph the smaller its population. Size of circle represents the number of the airports that serve that particular city i.e. cities with big circles have many airports. Links represent the flight connections between the cities. For the visual purposes only intercontinental connections are shown.
	   
	    <h3>Why?</h3>Motivated by the <a href="http://neo4j.com/showmeyourgraph-rules/" target="_blank">Neo4j #ShowMeYourGraph Twitter Contest</a> for a graph visualization I finally girded up my lions to try working with the hive plot. <a href="http://www.hiveplot.net/" target="_blank">Hive plot</a> is a special graph layout by <a href="http://mkweb.bcgsc.ca/" target="_blank">Martin Krzywinski</a> which attempts to position the nodes in a meaningful way. I really like the idea as I agree that for networks with many nodes and connections it can give much more insights into the data set compared to other 'hair ball' styled layouts e.g. force directed.
	   
		<h3>How?</h3>Visualization was created using D3.js (starting from this <a href="http://bl.ocks.org/mbostock/2066415" target="_blank">template</a>) and the code is open and available on <a href="https://github.com/Domajno/Air-traffic-visualization.git" target="_blank">GitHub</a>.<br/>
		Moreover, I decided to talk a very good friend of mine who is a professional photographer and a graphic designer into participating together. I took charge of the tedious work of data cleaning and preparation while he made sure that the final result is really pleasant to look at. At the end some scripting was added to make the experience interactive et voila. 
		
		<p>Made with <3 by <a href="http://cygalski.pl/" target="_blank">Dominik Cygalski</a> and <a href="http://www.luke-photography.com/" target="_blank">Lukasz Gajdek.</a></p>
		</div>
	</div>

	<script src="airports.js"></script>
	<script src="connections.js"></script>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://d3js.org/d3.hive.v0.min.js"></script>
<script>

window.onload = function() {

d3.select('#about').on('click', function () {
	d3.select('#info').style('display','block');
});
d3.select('#info').on('click', function () {
	if (d3.event && (d3.event.srcElement || d3.event.target) == document.getElementById('info'))
		d3.select('#info').style('display',null);
});



d3.select("#invert-btn").on('click', function () {
	var body = d3.select("body");
	var clas = "inverted";
	body.classed(clas, !body.classed(clas));
});

var width = 1280,
    height = 680,
    innerRadius = 10,
    outerRadius = 430;
	
var angle = d3.scale.ordinal().domain(d3.range(4)).rangePoints([0, 2 * Math.PI]),
    radius = d3.scale.linear().range([innerRadius, outerRadius]).nice(),
    color = d3.scale.category20().domain(d3.range(20));


var svg = d3.select("#graph").append("svg")
	.attr("viewBox", "0, 0, " + width + ", " + height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

svg.selectAll(".axis")
    .data(d3.range(3))
  .enter().append("line")
    .attr("class", "axis")
    .attr("transform", function(d) { return "rotate(" + degrees(angle(d)) + ")"; })
    .attr("x1", radius.range()[0])
    .attr("x2", radius.range()[1]*1.05);

svg.selectAll(".link")
    .data(links)
  .enter().append("path")
    .attr("class", "link")
    .attr("d", d3.hive.link()
    .angle(function(d) { return d?angle(d.x):0; })
    .radius(function(d) { return d?radius(d.y):0; }))
	.attr("data-s", function(d) {return d.source.id;})
	.attr("data-t", function(d) {return d.target.id;});

svg.selectAll(".node")
    .data(nodes)
  .enter().append("circle")
	.attr("class", function(d) { return "node " + d.x; })
	.attr("data-name", function(d) { return d.name; })
    .attr("transform", function(d) { return "rotate(" + degrees(angle(d.x)) + ")"; })
    .attr("cx", function(d) { return radius(d.y); })
    .attr("r", function(d) { return Math.sqrt(d.count * 4); })
	.attr("data-id", function(d, i) { return i; })
	.on("mousedown", function(d, i) {
		d3.selectAll("path").style('opacity', 0);
		d3.selectAll("path[data-s='" + i + "']").style('opacity', 1);
		d3.selectAll("path[data-t='" + i + "']").style('opacity', 1);
	})
	.on("mouseup", function(d, i) {
		d3.selectAll("path").style('opacity', 1);
	})
	.on("mouseout", function(d, i) {
		d3.selectAll("path").style('opacity', 1);
	})
	.append("svg:title")
          .text(function(d) { return d.name; });

svg.append('g').attr('transform', 'scale(0.25)rotate(-70)translate(680,400)')
	.append('path').attr('id', 'aircraft').attr('d', 'm54.82,16.917c0.023,-7.053 10.66,-7.053 10.66,0.202l0,29.621l41.453,24.925l0,10.947l-41.264,-13.58l0,22.12901l9.547,7.479l0,8.64101l-14.723,-4.57l-14.719,4.57l0,-8.64101l9.45,-7.479l0,-22.12901l-41.289,13.58l0,-10.947l40.885,-24.925l0,-29.823z');
	
	
svg.append('g').attr('transform', function(d) {return 'rotate(' + (degrees(angle(2)) - 180) + ')translate(-330,-3)';})
	.append('text').text("Europe");
svg.append('g').attr('transform', function(d) {return 'rotate(' + (degrees(angle(1))) + ')translate(330,-3)';})
	.append('text').text("Asia");
svg.append('g').attr('transform', function(d) {return 'rotate(' + (-degrees(angle(0))) + ')translate(-330,-3)';})
	.append('text').text("N. America");
	
function degrees(radians) {
  return radians / Math.PI * 180 - 90;
}

}

</script>
</body>
</html>